#!/bin/bash
prp_cplof_output() {
    cplof -N *.psl *.plof > output
    return $?
}

for i in autotests/prp/*
do
    bni=`basename $i`

    pushd $i
    
    # Compile requisite .psl files
    for j in *.apsl
    do
        pslasm $j ${j/.apsl}.psl
    done

    # Now run it
    runtest prp_${bni}_run prp_cplof_output
    runtest prp_${bni}_cmp cmp output expected
    rm -f output

    # Get rid of compiled .psl files
    for j in *.apsl
    do
        rm -f ${j/.apsl}.psl
    done
done
